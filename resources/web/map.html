<html>
  <head>
    <title>Map</title>
    <!--<link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css" type="text/css">-->
    <!--<script type= "text/javascript" src= "https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script type= "text/javascript" src= "/lib/core.js"></script>
    <script type= "text/javascript">
      function initialize () {
	  var mapId = urlPath ().last ()
	  
	  document.getElementById ("status").innerHTML = "map: " + mapId

	  var map = L.map("map").setView([45, 0], 4)
	  L.tileLayer(
	      "/tile/raster/" + mapId + "/{z}/{x}/{y}",
	      {
		  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
		  maxZoom: 18,
	      }).addTo(map)
	  
	  map.on (
	      "click",
	      function (e) {
		  setStatus (
		      "(" + Number (e.latlng.lng).toFixed (5) + "," +
			  Number (e.latlng.lat).toFixed (5)  + ")" )
	      }
	  )

	  retrieveConfiguration (mapId, function (configuration) {
	      map.setView (
		  [configuration.latitude, configuration.longitude],
		  configuration.zoom)
	  })
	  
	  retrieveLocations (mapId, function (locations) { addLocationsToMap (map, locations)})
      }
      </script>
  </head>
  <body>
    <!--<div id= "overlay" style= "width:20px;height:20px;">A</div>-->
    <div id= "content" class= "content">
      <div id= "map" style= "width:100%;height:calc(100% - 30px);"></div>
      <div id= "status" style= "width:100%;height:30px;"></div>
    </div>
    <script type= "text/javascript">
      initialize ();
    </script>
  </body>
</html>
